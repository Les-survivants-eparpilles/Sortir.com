<div class="container">

    <table class="table table-striped">
        <thead>
        <tr>
            <th scope="col">Nom de la sortie</th>
            <th scope="col">Date de la sortie</th>
            <th scope="col">Clôture</th>
            <th scope="col">inscrits/places</th>
            <th scope="col">Etat</th>
            <th scope="col">inscrits</th>
            <th scope="col">Organisateur</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for sortie in sorties %}

        <tr>
            <th scope="row">
                {{ sortie.nom }}
            </th>
            <td>
                {{ sortie.dateHeureDebut | date('d/m/Y H:i') }}
            </td>
            <td>
                {{ sortie.dateLimiteInscription | date('d/m/Y')}}
            </td>
            <td>
               {{ sortie.relation|length}} /{{ sortie.nbInscriptioonsMax }}
            </td>
            <td>
                {{ sortie.etat.libelle }}
            </td>
            <td>
            {% for relation in sortie.relation %}
                   {% if user.id is same as (relation.id) %}
                       <span class="badge badge-info">inscrit</span>

                   {% endif %}
            {% endfor %}
            </td>
            <td>
                <a href="{{ path("participant_autreProfil", {"id" : sortie.organisateur.id}) }}">
                    {{ sortie.organisateur.nom }}
                </a>
            </td>
            <td>

                {#  Bouton Afficher #}
                {% if sortie.etat.id != 1 %}
                <a href="{{ path("sortie_detail", {"id" : sortie.id}) }}">Afficher</a>
                {% endif %}

                {#  Bouton s'inscrire et se désister   #}
                {% set pasInscrit=true %}
                {% if sortie.etat.id == 2 %}
                    {#Vérification si l'utilisateur est déjà inscrit ou non#}
                    {% for participant in sortie.relation %}
                        {%  if participant.id==user.id %}
                            {% set pasInscrit=false %}
                        {% endif %}
                    {% endfor %}

                    {#Si pas inscrit et sortie ouverte, alors bouton s'inscrire'#}
                    {% if pasInscrit==true %}
                        <a href="{{ path("gestionEtat_inscrire", {"id" :sortie.id }) }}">S'inscrire</a>
                    {% endif %}
                {% endif %}

                {#  Bouton Se desister si déjà cloturée mais déjà inscrit #}
                {% if sortie.etat.id ==3 and pasInscrit==false %}
                    <a href="{{ path("gestionEtat_desister", {"id" :sortie.id }) }}">Se désister</a>=
                {% endif %}

                {#  Bouton Modifier   #}
                {% if user.id == sortie.organisateur.id and sortie.etat.id==1  %}
                <a href="{{ path("sortie_detail", {"id" :sortie.id }) }}">Modifier</a>

                {#Bouton Publier#}
                <a href="{{ path("sortie_detail", {"id" :sortie.id }) }}">Publier</a>
                {% endif %}

                {#Bouton Annuler#}
                {% if user.id == sortie.organisateur.id and sortie.etat.id in [2, 3, 4] %}
                <a href="{{ path("sortie_detail", {"id" :sortie.id }) }}">Annuler</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

</div>